<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>é­”æ³•å¤©æ°”æ’­æŠ¥å‘˜</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
    header{padding:18px 16px;background:#5aa2ff;color:#fff;font-weight:700;text-align:center}
    .card{margin:14px auto;max-width:560px;background:#fff;border-radius:14px;padding:16px;
      box-shadow:0 6px 18px rgba(0,0,0,.08)}
    .muted{color:#667085}
    .btn{display:inline-block;background:#2563eb;color:#fff;border:none;border-radius:10px;
      padding:10px 16px;font-weight:600}
    video,img{max-width:100%;border-radius:12px}
    .row{display:flex;gap:10px;align-items:center}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  </style>
</head>
<body>
  <header>ğŸŒ¤ é­”æ³•å¤©æ°”æ’­æŠ¥å‘˜</header>

  <div class="card">
    <div id="loc" class="muted">æ­£åœ¨è¯·æ±‚å®šä½æƒé™â€¦</div>
    <div id="wx" style="margin-top:6px">å¤©æ°”æ•°æ®åŠ è½½ä¸­â€¦</div>
    <div id="tip" style="margin-top:8px">âœ¨ ç­‰å¾…é­”æ³•æ’­æŠ¥â€¦</div>
    <div id="err" style="margin-top:8px;color:#e11d48"></div>
    <div style="margin-top:10px">
      <button class="btn" id="retry">é‡æ–°è·å–å®šä½</button>
    </div>
  </div>

  <div class="card">
    <h3>ğŸ¬ è§†é¢‘æ’­æŠ¥</h3>
    <video id="v" controls playsinline>
      <source src="video1.mp4" type="video/mp4"/>
      æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
    </video>
  </div>

  <div class="card">
    <h3>ğŸŒ€ å¤©æ°”å›¾ç‰‡ / AR</h3>
    <img src="1.png" alt="å¤©æ°”å ä½å›¾"/>
    <p class="muted" style="margin:8px 0 12px">iOS Safari ç‚¹å‡»ä¸‹æ–¹è¿›å…¥ ARï¼ˆUSDZï¼‰</p>
    <a class="btn" rel="ar" href="model.usdz">è¿›å…¥ AR</a>
  </div>

  <div class="card">
    <h3>ğŸ§ª è°ƒè¯•ä¿¡æ¯</h3>
    <div class="row"><div class="muted">åæ ‡ï¼š</div><code id="xy" class="mono">-</code></div>
    <div class="row"><div class="muted">è¯·æ±‚URLï¼š</div><code id="req" class="mono">-</code></div>
    <div class="row"><div class="muted">HTTPï¼š</div><code id="http" class="mono">-</code></div>
    <div class="row"><div class="muted">è¿”å›ç ï¼š</div><code id="code" class="mono">-</code></div>
  </div>

<script>
/** ========= å¿…å¡«é…ç½® ========= */
const API_HOST = 'https://m42r6wma94.re.qweatherapi.com'; // â† ç”¨ä½ æ§åˆ¶å°é‡Œçš„ API Host
const API_KEY  = '6b643f91d5b34f74b75d835a3e72377f';                      // â† ç”¨ä½ æ§åˆ¶å°ç”Ÿæˆçš„ API Key
/** ========================== */

// å¤©æ°” â†’ æ–‡æ¡ˆæ˜ å°„
const tipsMap = {
  'æ™´': ['ä»Šå¤©é˜³å…‰æ˜åªšï¼Œé€‚åˆå‡ºé—¨èµ°èµ° ğŸŒ', 'æ™´ç©ºä¸‡é‡Œï¼Œå¿ƒæƒ…ä¹Ÿè·Ÿç€æ˜äº®èµ·æ¥ï¼'],
  'é›¨': ['è®°å¾—å¸¦ä¼å“¦ï¼Œåˆ«è®©è‡ªå·±æ·‹æ¹¿å•¦ â˜”', 'å°é›¨æ»‹æ¶¦å¤§åœ°ï¼Œç©ºæ°”æ›´æ¸…æ–°ï½'],
  'é›ª': ['é£˜é›ªçš„æ—¥å­æœ€æµªæ¼« â„', 'å‡ºé—¨æ³¨æ„ä¿æš–ï¼Œèµé›ªä¹Ÿè¦æ³¨æ„å®‰å…¨ï½'],
  'é˜´': ['é˜´å¤©æœ‰ç‚¹å°å¿§éƒ â˜ï¼Œä¹Ÿè¦å…ƒæ°”æ»¡æ»¡ï½'],
  'å¤šäº‘': ['äº‘æœµç²¾çµå‡ºæ¥å•¦ï½'],
  'é»˜è®¤': ['æ— è®ºå¤©æ°”å¦‚ä½•ï¼Œä»Šå¤©ä¹Ÿè¦åŠ æ²¹ï¼âœ¨']
};

const $ = (id)=>document.getElementById(id);
$('retry').addEventListener('click', getLocation);

function getLocation(){
  $('err').textContent='';
  if(!('geolocation' in navigator)){
    $('loc').textContent='âŒ è®¾å¤‡ä¸æ”¯æŒå®šä½';
    return useMock('ä¸æ”¯æŒå®šä½');
  }
  $('loc').textContent='ğŸ“ æ­£åœ¨å®šä½â€¦';
  navigator.geolocation.getCurrentPosition(
    pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude; // å’Œé£ location=ç»åº¦,çº¬åº¦
      $('xy').textContent = `${lat.toFixed(5)}, ${lon.toFixed(5)}`;
      fetchWeather(lon, lat);
    },
    err => {
      $('loc').textContent='âŒ å®šä½å¤±è´¥ï¼Œå·²ä½¿ç”¨é»˜è®¤åŸå¸‚';
      $('err').textContent=`Geolocation error: ${err.code} ${err.message||''}`;
      useMock('å®šä½å¤±è´¥');
    },
    {enableHighAccuracy:true, timeout:10000, maximumAge:30000}
  );
}

async function fetchWeather(lon, lat){
  const url = `${API_HOST}/v7/weather/now?location=${lon},${lat}`;
  $('req').textContent = url;

  try{
    const res = await fetch(url, {
      method:'GET',
      headers: { 'X-QW-Api-Key': API_KEY }   // å…³é”®ï¼šç”¨ Header ä¼  Key
    });
    $('http').textContent = `HTTP ${res.status}`;
    if(!res.ok) throw new Error('http '+res.status);

    const data = await res.json();
    $('code').textContent = data.code || '-';

    if(data.code !== '200'){
      throw new Error('qweather code '+data.code);
    }

    const now = data.now;
    $('loc').textContent = `ğŸ“ å·²å®šä½ï¼Œå®æ—¶å¤©æ°”ï¼š${now.text} ${now.temp}â„ƒ`;
    $('wx').textContent  = `ä½“æ„Ÿ ${now.feelsLike}â„ƒ Â· é£ ${now.windDir}${now.windScale}çº§ Â· æ¹¿åº¦ ${now.humidity}%`;

    const arr = tipsMap[now.text] || tipsMap['é»˜è®¤'];
    $('tip').textContent = 'ğŸ”® ' + arr[Math.floor(Math.random()*arr.length)];

    // å¦‚éœ€æ ¹æ®å¤©æ°”åˆ‡æ¢è§†é¢‘/å›¾ç‰‡ï¼Œå¯åœ¨è¿™é‡Œåˆ¤æ–­ now.icon/now.text æ¥æ›¿æ¢ src
    // ä¾‹ï¼šif(now.text.includes('é›¨')) { document.getElementById('v').src='rain.mp4'; }
  }catch(e){
    $('err').textContent = 'è¯·æ±‚å¤±è´¥ï¼š'+ e.message;
    return useMock('æ¥å£å¤±è´¥');
  }
}

function useMock(reason){
  $('wx').textContent = 'ï¼ˆæ¨¡æ‹Ÿï¼‰å®æ—¶å¤©æ°”ï¼šæ™´ Â· 26â„ƒ';
  const arr = tipsMap['æ™´']; $('tip').textContent = 'ğŸ”® '+ arr[Math.floor(Math.random()*arr.length)];
  $('http').textContent = '-';
  $('code').textContent = '-';
  $('req').textContent = `mock (${reason})`;
}

getLocation();
</script>
</body>
</html>
